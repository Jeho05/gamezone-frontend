<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Vid√©o 1 - Correction</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
            max-width: 1000px;
            margin: 0 auto;
        }
        h1 { color: #a855f7; }
        .test-box {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #a855f7;
        }
        video {
            width: 100%;
            max-width: 600px;
            border: 3px solid #22c55e;
            border-radius: 10px;
            display: block;
            margin: 20px auto;
        }
        .success { color: #22c55e; font-weight: bold; }
        .error { color: #ef4444; font-weight: bold; }
        button {
            background: #a855f7;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover { background: #9333ea; }
        code {
            background: #1f2937;
            padding: 2px 6px;
            border-radius: 3px;
            color: #22c55e;
        }
    </style>
</head>
<body>
    <h1>üîß Test Vid√©o 1 - Solutions de Correction</h1>

    <!-- Solution 1: Test direct -->
    <div class="test-box">
        <h2>Solution 1: Vid√©o avec Nom Original</h2>
        <p>Fichier: <code>Cyber_Arcade_Neon_Ember.mp4</code></p>
        <video id="video-original" controls muted>
            <source src="/images/video/Cyber_Arcade_Neon_Ember.mp4" type="video/mp4">
        </video>
        <div id="status-original"></div>
        <button onclick="testVideo('video-original', 'status-original')">üîÑ Retester</button>
        <button onclick="document.getElementById('video-original').play()">‚ñ∂Ô∏è Lecture</button>
    </div>

    <!-- Solution 2: Test avec timestamp pour forcer le reload -->
    <div class="test-box">
        <h2>Solution 2: Avec Cache Busting</h2>
        <p>Fichier: <code>Cyber_Arcade_Neon_Ember.mp4?t=[timestamp]</code></p>
        <p style="font-size: 14px; color: #999;">Ajoute un param√®tre pour forcer le rechargement</p>
        <video id="video-cache" controls muted></video>
        <div id="status-cache"></div>
        <button onclick="loadWithCacheBusting()">üîÑ Charger avec Cache Busting</button>
    </div>

    <!-- Solution 3: Nouveau nom -->
    <div class="test-box">
        <h2>Solution 3: Nouveau Nom de Fichier</h2>
        <p>Fichier: <code>cyber-arcade-neon.mp4</code></p>
        <p style="font-size: 14px; color: #999;">Copie avec nom simplifi√© (si cr√©√©e)</p>
        <video id="video-new" controls muted>
            <source src="/images/video/cyber-arcade-neon.mp4" type="video/mp4">
        </video>
        <div id="status-new"></div>
        <button onclick="testVideo('video-new', 'status-new')">üîÑ Retester</button>
    </div>

    <!-- Infos debug -->
    <div class="test-box" style="border-color: #3b82f6;">
        <h2>üìä Diagnostic</h2>
        <div id="debug-info"></div>
        <button onclick="runDiagnostic()">üîç Lancer Diagnostic</button>
    </div>

    <script>
        function testVideo(videoId, statusId) {
            const video = document.getElementById(videoId);
            const status = document.getElementById(statusId);

            if (!video) {
                status.innerHTML = '<span class="error">‚ùå √âl√©ment vid√©o introuvable</span>';
                return;
            }

            status.innerHTML = '‚è≥ Test en cours...';

            // Reset
            video.load();

            // Test chargement
            video.onloadeddata = () => {
                status.innerHTML = '<span class="success">‚úÖ Vid√©o charg√©e avec succ√®s!</span>';
                console.log('‚úÖ Vid√©o OK:', videoId);
            };

            video.onerror = (e) => {
                const error = video.error;
                let errorMsg = 'Erreur inconnue';
                if (error) {
                    switch(error.code) {
                        case 1: errorMsg = 'Chargement abandonn√©'; break;
                        case 2: errorMsg = 'Erreur r√©seau'; break;
                        case 3: errorMsg = 'Erreur de d√©codage'; break;
                        case 4: errorMsg = 'Format non support√©'; break;
                    }
                }
                status.innerHTML = `<span class="error">‚ùå ${errorMsg}</span>`;
                console.error('‚ùå Erreur vid√©o:', videoId, error);
            };
        }

        function loadWithCacheBusting() {
            const video = document.getElementById('video-cache');
            const status = document.getElementById('status-cache');
            const timestamp = new Date().getTime();
            
            status.innerHTML = '‚è≥ Chargement avec cache busting...';
            
            video.innerHTML = `<source src="/images/video/Cyber_Arcade_Neon_Ember.mp4?t=${timestamp}" type="video/mp4">`;
            video.load();

            video.onloadeddata = () => {
                status.innerHTML = '<span class="success">‚úÖ Charg√© avec succ√®s!</span>';
                console.log('‚úÖ Cache busting OK');
            };

            video.onerror = (e) => {
                status.innerHTML = '<span class="error">‚ùå √âchec m√™me avec cache busting</span>';
                console.error('‚ùå Cache busting √©chec');
            };
        }

        function runDiagnostic() {
            const debug = document.getElementById('debug-info');
            let html = '<h3>R√©sultats du diagnostic:</h3>';

            // Test 1: Fetch de la vid√©o
            html += '<p>‚è≥ Test de fetch...</p>';
            debug.innerHTML = html;

            fetch('/images/video/Cyber_Arcade_Neon_Ember.mp4')
                .then(response => {
                    console.log('Fetch response:', response);
                    const contentType = response.headers.get('content-type');
                    
                    html += `<p><strong>Status HTTP:</strong> ${response.status} ${response.statusText}</p>`;
                    html += `<p><strong>Content-Type:</strong> <code>${contentType}</code></p>`;
                    
                    if (contentType && contentType.includes('video')) {
                        html += '<p class="success">‚úÖ Content-Type correct!</p>';
                    } else if (contentType && contentType.includes('html')) {
                        html += '<p class="error">‚ùå Serveur retourne du HTML (404?)</p>';
                        html += '<p><strong>Solution:</strong> La vid√©o n\'est pas trouv√©e par le serveur</p>';
                    } else {
                        html += '<p class="error">‚ö†Ô∏è Content-Type inattendu</p>';
                    }

                    html += `<p><strong>Taille:</strong> ${response.headers.get('content-length') || 'Inconnue'}</p>`;
                    
                    debug.innerHTML = html;
                })
                .catch(error => {
                    html += `<p class="error">‚ùå Erreur fetch: ${error.message}</p>`;
                    debug.innerHTML = html;
                    console.error('Fetch error:', error);
                });
        }

        // Tests automatiques au chargement
        window.onload = () => {
            console.log('üîß Page de correction vid√©o charg√©e');
            
            // Test automatique apr√®s 1 seconde
            setTimeout(() => {
                testVideo('video-original', 'status-original');
                testVideo('video-new', 'status-new');
            }, 1000);
        };
    </script>
</body>
</html>
